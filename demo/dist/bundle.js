import V,{createContext as Ae,useReducer as Te}from"react";import{createRoot as Pe}from"react-dom/client";function F({latency:e=120}={}){let n={"/":{title:"Home",pageData:{blurb:"Welcome to the demo."}},"/about":{title:"About",pageData:{blurb:"This is a mock backend."}}},t=/^\/users\/([^/]+)$/;globalThis.fetch=async r=>{let a=new URL(r,location.origin).pathname,o=200,v=n[a];if(!v){let f=a.match(t);if(f){let u=f[1];v={title:`User ${u}`,pageData:{id:u,role:"tester"}}}}return v||(o=404,v={title:"Not Found",pageData:{path:a}}),await new Promise(f=>setTimeout(f,e)),{status:o,json:async()=>v}}}import X,{useContext as me,useEffect as ye,useMemo as ve,useRef as ge,useState as xe}from"react";function L(){return L=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},L.apply(this,arguments)}var H;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(H||(H={}));var K=function(e){return e};var J="beforeunload";var ne="popstate";function W(e){e===void 0&&(e={});var n=e,t=n.window,r=t===void 0?document.defaultView:t,i=r.history;function a(){var c=r.location,h=c.pathname,w=c.search,T=c.hash,$=i.state||{};return[$.idx,K({pathname:h,search:w,hash:T,state:$.usr||null,key:$.key||"default"})]}var o=null;function v(){if(o)g.call(o),o=null;else{var c=H.Pop,h=a(),w=h[0],T=h[1];if(g.length){if(w!=null){var $=l-w;$&&(o={action:c,location:T,retry:function(){A($*-1)}},A($))}}else C(c)}}r.addEventListener(ne,v);var f=H.Pop,u=a(),l=u[0],y=u[1],s=G(),g=G();l==null&&(l=0,i.replaceState(L({},i.state,{idx:l}),""));function p(c){return typeof c=="string"?c:oe(c)}function d(c,h){return h===void 0&&(h=null),K(L({pathname:y.pathname,hash:"",search:""},typeof c=="string"?ie(c):c,{state:h,key:re()}))}function x(c,h){return[{usr:c.state,key:c.key,idx:h},p(c)]}function E(c,h,w){return!g.length||(g.call({action:c,location:h,retry:w}),!1)}function C(c){f=c;var h=a();l=h[0],y=h[1],s.call({action:f,location:y})}function b(c,h){var w=H.Push,T=d(c,h);function $(){b(c,h)}if(E(w,T,$)){var N=x(T,l+1),M=N[0],D=N[1];try{i.pushState(M,"",D)}catch{r.location.assign(D)}C(w)}}function S(c,h){var w=H.Replace,T=d(c,h);function $(){S(c,h)}if(E(w,T,$)){var N=x(T,l),M=N[0],D=N[1];i.replaceState(M,"",D),C(w)}}function A(c){i.go(c)}var _={get action(){return f},get location(){return y},createHref:p,push:b,replace:S,go:A,back:function(){A(-1)},forward:function(){A(1)},listen:function(h){return s.push(h)},block:function(h){var w=g.push(h);return g.length===1&&r.addEventListener(J,B),function(){w(),g.length||r.removeEventListener(J,B)}}};return _}function B(e){e.preventDefault(),e.returnValue=""}function G(){var e=[];return{get length(){return e.length},push:function(t){return e.push(t),function(){e=e.filter(function(r){return r!==t})}},call:function(t){e.forEach(function(r){return r&&r(t)})}}}function re(){return Math.random().toString(36).substr(2,8)}function oe(e){var n=e.pathname,t=n===void 0?"/":n,r=e.search,i=r===void 0?"":r,a=e.hash,o=a===void 0?"":a;return i&&i!=="?"&&(t+=i.charAt(0)==="?"?i:"?"+i),o&&o!=="#"&&(t+=o.charAt(0)==="#"?o:"#"+o),t}function ie(e){var n={};if(e){var t=e.indexOf("#");t>=0&&(n.hash=e.substr(t),e=e.substr(0,t));var r=e.indexOf("?");r>=0&&(n.search=e.substr(r),e=e.substr(0,r)),e&&(n.pathname=e)}return n}var z=typeof window<"u"&&window.document&&window.document.createElement?W():null;var P=z;import R from"react";function ae(e){let n=[],t=0;for(;t<e.length;){let r=e[t];if(r==="*"||r==="+"||r==="?"){n.push({type:"MODIFIER",index:t,value:e[t++]});continue}if(r==="\\"){n.push({type:"ESCAPED_CHAR",index:t++,value:e[t++]});continue}if(r==="{"){n.push({type:"OPEN",index:t,value:e[t++]});continue}if(r==="}"){n.push({type:"CLOSE",index:t,value:e[t++]});continue}if(r===":"){let i="",a=t+1;for(;a<e.length;){let o=e.charCodeAt(a);if(o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122||o===95){i+=e[a++];continue}break}if(!i)throw new TypeError(`Missing parameter name at ${t}`);n.push({type:"NAME",index:t,value:i}),t=a;continue}if(r==="("){let i=1,a="",o=t+1;if(e[o]==="?")throw new TypeError(`Pattern cannot start with "?" at ${o}`);for(;o<e.length;){if(e[o]==="\\"){a+=e[o++]+e[o++];continue}if(e[o]===")"){if(i--,i===0){o++;break}}else if(e[o]==="("&&(i++,e[o+1]!=="?"))throw new TypeError(`Capturing groups are not allowed at ${o}`);a+=e[o++]}if(i)throw new TypeError(`Unbalanced pattern at ${t}`);if(!a)throw new TypeError(`Missing pattern at ${t}`);n.push({type:"PATTERN",index:t,value:a}),t=o;continue}n.push({type:"CHAR",index:t,value:e[t++]})}return n.push({type:"END",index:t,value:""}),n}function ce(e,n={}){let t=ae(e),{prefixes:r="./",delimiter:i="/#?"}=n,a=[],o=0,v=0,f="",u=p=>{if(v<t.length&&t[v].type===p)return t[v++].value},l=p=>{let d=u(p);if(d!==void 0)return d;let{type:x,index:E}=t[v];throw new TypeError(`Unexpected ${x} at ${E}, expected ${p}`)},y=()=>{let p="",d;for(;d=u("CHAR")||u("ESCAPED_CHAR");)p+=d;return p},s=p=>{for(let d of i)if(p.indexOf(d)>-1)return!0;return!1},g=p=>{let d=a[a.length-1],x=p||(d&&typeof d=="string"?d:"");if(d&&!x)throw new TypeError(`Must have text between two parameters, missing text after "${d.name}"`);return!x||s(x)?`[^${O(i)}]+?`:`(?:(?!${O(x)})[^${O(i)}])+?`};for(;v<t.length;){let p=u("CHAR"),d=u("NAME"),x=u("PATTERN");if(d||x){let b=p||"";r.indexOf(b)===-1&&(f+=b,b=""),f&&(a.push(f),f=""),a.push({name:d||o++,prefix:b,suffix:"",pattern:x||g(b),modifier:u("MODIFIER")||""});continue}let E=p||u("ESCAPED_CHAR");if(E){f+=E;continue}if(f&&(a.push(f),f=""),u("OPEN")){let b=y(),S=u("NAME")||"",A=u("PATTERN")||"",_=y();l("CLOSE"),a.push({name:S||(A?o++:""),pattern:S&&!A?g(b):A,prefix:b,suffix:_,modifier:u("MODIFIER")||""});continue}l("END")}return a}function Y(e,n){let t=[],r=Q(e,t,n);return se(r,t,n)}function se(e,n,t={}){let{decode:r=i=>i}=t;return function(i){let a=e.exec(i);if(!a)return!1;let{0:o,index:v}=a,f=Object.create(null);for(let u=1;u<a.length;u++){if(a[u]===void 0)continue;let l=n[u-1];l.modifier==="*"||l.modifier==="+"?f[l.name]=a[u].split(l.prefix+l.suffix).map(y=>r(y,l)):f[l.name]=r(a[u],l)}return{path:o,index:v,params:f}}}function O(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function q(e){return e&&e.sensitive?"":"i"}function ue(e,n){if(!n)return e;let t=/\((?:\?<(.*?)>)?(?!\?)/g,r=0,i=t.exec(e.source);for(;i;)n.push({name:i[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),i=t.exec(e.source);return e}function fe(e,n,t){let r=e.map(i=>Q(i,n,t).source);return new RegExp(`(?:${r.join("|")})`,q(t))}function le(e,n,t){return pe(ce(e,t),n,t)}function pe(e,n,t={}){let{strict:r=!1,start:i=!0,end:a=!0,encode:o=s=>s,delimiter:v="/#?",endsWith:f=""}=t,u=`[${O(f)}]|$`,l=`[${O(v)}]`,y=i?"^":"";for(let s of e)if(typeof s=="string")y+=O(o(s));else{let g=O(o(s.prefix)),p=O(o(s.suffix));if(s.pattern)if(n&&n.push(s),g||p)if(s.modifier==="+"||s.modifier==="*"){let d=s.modifier==="*"?"?":"";y+=`(?:${g}((?:${s.pattern})(?:${p}${g}(?:${s.pattern}))*)${p})${d}`}else y+=`(?:${g}(${s.pattern})${p})${s.modifier}`;else{if(s.modifier==="+"||s.modifier==="*")throw new TypeError(`Can not repeat "${s.name}" without a prefix and suffix`);y+=`(${s.pattern})${s.modifier}`}else y+=`(?:${g}${p})${s.modifier}`}if(a)r||(y+=`${l}?`),y+=t.endsWith?`(?=${u})`:"$";else{let s=e[e.length-1],g=typeof s=="string"?l.indexOf(s[s.length-1])>-1:s===void 0;r||(y+=`(?:${l}(?=${u}))?`),g||(y+=`(?=${l}|${u})`)}return new RegExp(y,q(t))}function Q(e,n,t){return e instanceof RegExp?ue(e,n):Array.isArray(e)?fe(e,n,t):le(e,n,t)}var he=()=>R.createElement("div",{style:{padding:24}},R.createElement("h1",null,"404"),R.createElement("p",null,"Page not found")),de=(e,n)=>{for(let t of e){let r=t.matcher(n);if(r)return{route:t,params:r.params||{}}}return null},j={match:(e,n)=>{let t=de(e,n);if(!t)return{Component:he,reducerKey:null,params:{}};let{route:r,params:i}=t,{Component:a,reducerKey:o}=r;return{Component:a,reducerKey:o,params:i}},prepare:e=>Array.isArray(e)?e:Object.keys(e).map(n=>{let t=e[n],r,i;return Array.isArray(t)?[r,i]=t:r=t,{path:n,matcher:Y(n,{decode:decodeURIComponent}),Component:r,reducerKey:i||null}})};var k=({to:e,replace:n=!1,state:t,onClick:r,...i})=>{let a=o=>{r&&r(o),!(o.defaultPrevented||o.button!==0||o.metaKey||o.altKey||o.ctrlKey||o.shiftKey)&&(o.preventDefault(),n?P.replace(e,t):P.push(e,t))};return X.createElement("a",{href:typeof e=="string"?e:e?.pathname||"#",onClick:a,...i})},we=(e,n)=>{let t=e.find(r=>r.path===n);return t||e.find(r=>r.path==="*")||null},I=(e,n)=>t=>{let r=n?me(n):{state:t,dispatch:!1},{state:i,dispatch:a}=r||{};e=j.prepare(e);let o=(P?.location?.pathname||"")+(P?.location?.search||""),v=i&&i.location||o,f=ge(v),[u,l]=xe(v);ye(()=>{if(!P||typeof P.listen!="function")return;let p=P.listen(({location:d,action:x})=>{let E=(d.pathname||"")+(d.search||"");E!==f.current&&(f.current=E,l(E),typeof a=="function"&&a({type:"LOCATION_CHANGED",location:E,meta:{action:x}}))});return()=>{typeof p=="function"&&p()}},[a]);let y=(u||"").split("?")[0],g=ve(()=>we(e,y),[e,y])?.Component||(()=>null);return X.createElement(g,null)};import m from"react";var Ee=e=>m.createElement("div",{style:{padding:24}},m.createElement("h1",null,"Home"),m.createElement("p",null,"This is a tiny demo using the modernized router."),m.createElement("nav",{style:{display:"flex",gap:12}},m.createElement(k,{to:"/"},"Home"),m.createElement(k,{to:"/about"},"About"),m.createElement(k,{to:"/users/42"},"User 42")),m.createElement("pre",{style:{background:"#f6f8fa",padding:12,marginTop:16}},JSON.stringify({state:e},null,2))),be=e=>m.createElement("div",{style:{padding:24}},m.createElement("h1",null,"About"),m.createElement("p",null,"Try navigating with modifier keys to open in a new tab."),m.createElement("nav",{style:{display:"flex",gap:12}},m.createElement(k,{to:"/"},"Home"),m.createElement(k,{to:"/about"},"About"),m.createElement(k,{to:"/users/123"},"User 123")),m.createElement("pre",{style:{background:"#f6f8fa",padding:12,marginTop:16}},JSON.stringify({state:e},null,2))),$e=({params:e,...n})=>m.createElement("div",{style:{padding:24}},m.createElement("h1",null,"User"),m.createElement("p",null,"User ID: ",m.createElement("strong",null,e.id)),m.createElement("nav",{style:{display:"flex",gap:12}},m.createElement(k,{to:"/"},"Home"),m.createElement(k,{to:"/about"},"About")),m.createElement("pre",{style:{background:"#f6f8fa",padding:12,marginTop:16}},JSON.stringify({params:e,state:n},null,2))),ke={"/":Ee,"/about":be,"/users/:id":$e},Z=ke;var ee={location:"/",title:"Demo",pageData:{}};function U(e,n){switch(n.type){case"LOCATION_CHANGED":return{...e,location:n.location};case"CHANGE_PAGE":{let t={...e,...n.data};return n.data&&n.data.location&&(t.location=n.data.location),t}default:return e}}F();var te=Ae(null),Oe=({children:e})=>{let[n,t]=Te(U,ee);return V.createElement(te.Provider,{value:{state:n,dispatch:t}},e)},Ne=I(Z,te),Le=Pe(document.getElementById("root"));Le.render(V.createElement(Oe,null,V.createElement(Ne,null)));export{te as StateContext};
