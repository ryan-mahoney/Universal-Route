var le=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(n,t)=>(typeof require<"u"?require:n)[t]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});import J,{createContext as De,useReducer as Re}from"react";import{createRoot as Me}from"react-dom/client";function G({latency:e=120}={}){let n={"/":{title:"Home",pageData:{blurb:"Welcome to the demo."}},"/about":{title:"About",pageData:{blurb:"This is a mock backend."}}},t=/^\/users\/([^/]+)$/;globalThis.fetch=async r=>{let a=new URL(r,location.origin).pathname,i=200,g=n[a];if(!g){let u=a.match(t);if(u){let c=u[1];g={title:`User ${c}`,pageData:{id:c,role:"tester"}}}}return g||(i=404,g={title:"Not Found",pageData:{path:a}}),await new Promise(u=>setTimeout(u,e)),{status:i,json:async()=>g}}}import H from"react";function L(){return L=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},L.apply(this,arguments)}var N;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(N||(N={}));var B=function(e){return e};var W="beforeunload";var fe="popstate";function q(e){e===void 0&&(e={});var n=e,t=n.window,r=t===void 0?document.defaultView:t,o=r.history;function a(){var l=r.location,d=l.pathname,v=l.search,k=l.hash,E=o.state||{};return[E.idx,B({pathname:d,search:v,hash:k,state:E.usr||null,key:E.key||"default"})]}var i=null;function g(){if(i)h.call(i),i=null;else{var l=N.Pop,d=a(),v=d[0],k=d[1];if(h.length){if(v!=null){var E=f-v;E&&(i={action:l,location:k,retry:function(){T(E*-1)}},T(E))}}else D(l)}}r.addEventListener(fe,g);var u=N.Pop,c=a(),f=c[0],p=c[1],s=Y(),h=Y();f==null&&(f=0,o.replaceState(L({},o.state,{idx:f}),""));function y(l){return typeof l=="string"?l:de(l)}function x(l,d){return d===void 0&&(d=null),B(L({pathname:p.pathname,hash:"",search:""},typeof l=="string"?he(l):l,{state:d,key:pe()}))}function w(l,d){return[{usr:l.state,key:l.key,idx:d},y(l)]}function P(l,d,v){return!h.length||(h.call({action:l,location:d,retry:v}),!1)}function D(l){u=l;var d=a();f=d[0],p=d[1],s.call({action:u,location:p})}function b(l,d){var v=N.Push,k=x(l,d);function E(){b(l,d)}if(P(v,k,E)){var O=w(k,f+1),U=O[0],R=O[1];try{o.pushState(U,"",R)}catch{r.location.assign(R)}D(v)}}function _(l,d){var v=N.Replace,k=x(l,d);function E(){_(l,d)}if(P(v,k,E)){var O=w(k,f),U=O[0],R=O[1];o.replaceState(U,"",R),D(v)}}function T(l){o.go(l)}var j={get action(){return u},get location(){return p},createHref:y,push:b,replace:_,go:T,back:function(){T(-1)},forward:function(){T(1)},listen:function(d){return s.push(d)},block:function(d){var v=h.push(d);return h.length===1&&r.addEventListener(W,z),function(){v(),h.length||r.removeEventListener(W,z)}}};return j}function z(e){e.preventDefault(),e.returnValue=""}function Y(){var e=[];return{get length(){return e.length},push:function(t){return e.push(t),function(){e=e.filter(function(r){return r!==t})}},call:function(t){e.forEach(function(r){return r&&r(t)})}}}function pe(){return Math.random().toString(36).substr(2,8)}function de(e){var n=e.pathname,t=n===void 0?"/":n,r=e.search,o=r===void 0?"":r,a=e.hash,i=a===void 0?"":a;return o&&o!=="?"&&(t+=o.charAt(0)==="?"?o:"?"+o),i&&i!=="#"&&(t+=i.charAt(0)==="#"?i:"#"+i),t}function he(e){var n={};if(e){var t=e.indexOf("#");t>=0&&(n.hash=e.substr(t),e=e.substr(0,t));var r=e.indexOf("?");r>=0&&(n.search=e.substr(r),e=e.substr(0,r)),e&&(n.pathname=e)}return n}var X=typeof window<"u"&&window.document&&window.document.createElement?q():null;var S=X;var Q="scroll",me=()=>({y:window.pageYOffset||document.documentElement.scrollTop||0,x:window.pageXOffset||document.documentElement.scrollLeft||0}),ye=()=>{let{pathname:e,search:n}=window.location;return`${e}${n||""}`},Z=()=>{if(typeof sessionStorage>"u")return{};try{let e=sessionStorage.getItem(Q);return e?JSON.parse(e):{}}catch{return{}}},ge=e=>{if(!(typeof sessionStorage>"u"))try{sessionStorage.setItem(Q,JSON.stringify(e))}catch{}},ee=()=>{let e=Z();e[ye()]=me(),ge(e)};var te=(e="*")=>{let n=Z();return e==="*"?n:n[e]||null};import I from"react";function xe(e){let n=[],t=0;for(;t<e.length;){let r=e[t];if(r==="*"||r==="+"||r==="?"){n.push({type:"MODIFIER",index:t,value:e[t++]});continue}if(r==="\\"){n.push({type:"ESCAPED_CHAR",index:t++,value:e[t++]});continue}if(r==="{"){n.push({type:"OPEN",index:t,value:e[t++]});continue}if(r==="}"){n.push({type:"CLOSE",index:t,value:e[t++]});continue}if(r===":"){let o="",a=t+1;for(;a<e.length;){let i=e.charCodeAt(a);if(i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122||i===95){o+=e[a++];continue}break}if(!o)throw new TypeError(`Missing parameter name at ${t}`);n.push({type:"NAME",index:t,value:o}),t=a;continue}if(r==="("){let o=1,a="",i=t+1;if(e[i]==="?")throw new TypeError(`Pattern cannot start with "?" at ${i}`);for(;i<e.length;){if(e[i]==="\\"){a+=e[i++]+e[i++];continue}if(e[i]===")"){if(o--,o===0){i++;break}}else if(e[i]==="("&&(o++,e[i+1]!=="?"))throw new TypeError(`Capturing groups are not allowed at ${i}`);a+=e[i++]}if(o)throw new TypeError(`Unbalanced pattern at ${t}`);if(!a)throw new TypeError(`Missing pattern at ${t}`);n.push({type:"PATTERN",index:t,value:a}),t=i;continue}n.push({type:"CHAR",index:t,value:e[t++]})}return n.push({type:"END",index:t,value:""}),n}function ve(e,n={}){let t=xe(e),{prefixes:r="./",delimiter:o="/#?"}=n,a=[],i=0,g=0,u="",c=y=>{if(g<t.length&&t[g].type===y)return t[g++].value},f=y=>{let x=c(y);if(x!==void 0)return x;let{type:w,index:P}=t[g];throw new TypeError(`Unexpected ${w} at ${P}, expected ${y}`)},p=()=>{let y="",x;for(;x=c("CHAR")||c("ESCAPED_CHAR");)y+=x;return y},s=y=>{for(let x of o)if(y.indexOf(x)>-1)return!0;return!1},h=y=>{let x=a[a.length-1],w=y||(x&&typeof x=="string"?x:"");if(x&&!w)throw new TypeError(`Must have text between two parameters, missing text after "${x.name}"`);return!w||s(w)?`[^${A(o)}]+?`:`(?:(?!${A(w)})[^${A(o)}])+?`};for(;g<t.length;){let y=c("CHAR"),x=c("NAME"),w=c("PATTERN");if(x||w){let b=y||"";r.indexOf(b)===-1&&(u+=b,b=""),u&&(a.push(u),u=""),a.push({name:x||i++,prefix:b,suffix:"",pattern:w||h(b),modifier:c("MODIFIER")||""});continue}let P=y||c("ESCAPED_CHAR");if(P){u+=P;continue}if(u&&(a.push(u),u=""),c("OPEN")){let b=p(),_=c("NAME")||"",T=c("PATTERN")||"",j=p();f("CLOSE"),a.push({name:_||(T?i++:""),pattern:_&&!T?h(b):T,prefix:b,suffix:j,modifier:c("MODIFIER")||""});continue}f("END")}return a}function ne(e,n){let t=[],r=oe(e,t,n);return we(r,t,n)}function we(e,n,t={}){let{decode:r=o=>o}=t;return function(o){let a=e.exec(o);if(!a)return!1;let{0:i,index:g}=a,u=Object.create(null);for(let c=1;c<a.length;c++){if(a[c]===void 0)continue;let f=n[c-1];f.modifier==="*"||f.modifier==="+"?u[f.name]=a[c].split(f.prefix+f.suffix).map(p=>r(p,f)):u[f.name]=r(a[c],f)}return{path:i,index:g,params:u}}}function A(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function re(e){return e&&e.sensitive?"":"i"}function be(e,n){if(!n)return e;let t=/\((?:\?<(.*?)>)?(?!\?)/g,r=0,o=t.exec(e.source);for(;o;)n.push({name:o[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),o=t.exec(e.source);return e}function Ee(e,n,t){let r=e.map(o=>oe(o,n,t).source);return new RegExp(`(?:${r.join("|")})`,re(t))}function $e(e,n,t){return Te(ve(e,t),n,t)}function Te(e,n,t={}){let{strict:r=!1,start:o=!0,end:a=!0,encode:i=s=>s,delimiter:g="/#?",endsWith:u=""}=t,c=`[${A(u)}]|$`,f=`[${A(g)}]`,p=o?"^":"";for(let s of e)if(typeof s=="string")p+=A(i(s));else{let h=A(i(s.prefix)),y=A(i(s.suffix));if(s.pattern)if(n&&n.push(s),h||y)if(s.modifier==="+"||s.modifier==="*"){let x=s.modifier==="*"?"?":"";p+=`(?:${h}((?:${s.pattern})(?:${y}${h}(?:${s.pattern}))*)${y})${x}`}else p+=`(?:${h}(${s.pattern})${y})${s.modifier}`;else{if(s.modifier==="+"||s.modifier==="*")throw new TypeError(`Can not repeat "${s.name}" without a prefix and suffix`);p+=`(${s.pattern})${s.modifier}`}else p+=`(?:${h}${y})${s.modifier}`}if(a)r||(p+=`${f}?`),p+=t.endsWith?`(?=${c})`:"$";else{let s=e[e.length-1],h=typeof s=="string"?f.indexOf(s[s.length-1])>-1:s===void 0;r||(p+=`(?:${f}(?=${c}))?`),h||(p+=`(?=${f}|${c})`)}return new RegExp(p,re(t))}function oe(e,n,t){return e instanceof RegExp?be(e,n):Array.isArray(e)?Ee(e,n,t):$e(e,n,t)}var ke=()=>I.createElement("div",{style:{padding:24}},I.createElement("h1",null,"404"),I.createElement("p",null,"Page not found")),Se=(e,n)=>{for(let t of e){let r=t.matcher(n);if(r)return{route:t,params:r.params||{}}}return null},M={match:(e,n)=>{let t=Se(e,n);if(!t)return{Component:ke,reducerKey:null,params:{}};let{route:r,params:o}=t,{Component:a,reducerKey:i}=r;return{Component:a,reducerKey:i,params:o}},prepare:e=>Object.keys(e).map(n=>{let t=e[n],r,o;return Array.isArray(t)?[r,o]=t:r=t,{path:n,matcher:ne(n,{decode:decodeURIComponent}),Component:r,reducerKey:o||null}})};var Ae=()=>{if(typeof globalThis<"u"&&globalThis.crypto){if(typeof globalThis.crypto.randomUUID=="function")return globalThis.crypto.randomUUID();let e=new Uint8Array(16);globalThis.crypto.getRandomValues(e),e[6]=e[6]&15|64,e[8]=e[8]&63|128;let n=[...e].map(t=>t.toString(16).padStart(2,"0"));return`${n.slice(0,4).join("")}-${n.slice(4,6).join("")}-${n.slice(6,8).join("")}-${n.slice(8,10).join("")}-${n.slice(10).join("")}`}try{let{randomUUID:e}=le("node:crypto");if(typeof e=="function")return e()}catch{}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let n=Math.random()*16|0;return(e==="x"?n:n&3|8).toString(16)})},ie=Symbol.for("handleHistoryChange:installed"),C=null;function Pe(){try{if(typeof window<"u"&&window.location&&window.location.origin)return window.location.origin}catch{}return"http://localhost"}function Oe(e){let n=new URL((e.pathname||"/")+(e.search||""),Pe());return n.searchParams.set("uuid",Ae()),n.toString()}function Le(e){return e===404?"404":Math.floor(e/100)===5?"5xx":"ok"}function F(e,{history:n,fetchImpl:t=typeof fetch<"u"&&fetch||null,setTitle:r=function(a){typeof document<"u"&&a&&(document.title=a)},progress:o={start(){},done(){}}}={}){!n||!t||n[ie]||(n[ie]=!0,n.listen(function({location:a,action:i}){if(C&&typeof C.abort=="function")try{C.abort()}catch{}C=typeof AbortController<"u"?new AbortController:null,o&&typeof o.done=="function"&&o.done(),o&&typeof o.start=="function"&&o.start();let g=Oe(a);Promise.resolve(t(g,{method:"GET",headers:{Accept:"application/json"},signal:C?C.signal:void 0})).then(function(u){let c=u&&u.json?u.json():{};return Promise.resolve(c).then(function(f){return{status:u?u.status:503,data:f||{}}}).catch(function(){return{status:u?u.status:503,data:{}}})}).catch(function(u){return{status:503,data:{}}}).then(function({status:u,data:c}){o&&typeof o.done=="function"&&o.done();let f=c&&c.authorization&&c.authorization.location,p=f||a.pathname||"/";if(!f){let s=Le(u);s==="404"?p="/404":s==="5xx"&&(p="/500")}if(e({type:"CHANGE_PAGE",data:Object.assign({},c,{location:p})}),c&&c.title&&r(c.title),typeof window<"u"&&window.scrollTo)if(i==="PUSH")window.scrollTo(0,0);else{let s=(a.pathname||"/")+(a.search||""),h=te(s);h&&setTimeout(function(){window.scrollTo(h.x||0,h.y||0)},250)}})}))}var ae=!1,$=({to:e,className:n,children:t,mode:r="push",onMouseEnter:o,onMouseLeave:a,style:i={},...g})=>H.createElement("a",{href:e,className:n,onClick:c=>{c.defaultPrevented||c.button!==0||c.metaKey||c.ctrlKey||c.altKey||c.shiftKey||(c.preventDefault(),ee(),S&&(r==="replace"?S.replace(e):S.push(e)))},onMouseEnter:o,onMouseLeave:a,style:i,...g},t);var K=(e,n)=>{if(!n)throw new Error("createRouter(routes, store): a store/context is required. Wrap your app with a Provider that supplies {state, dispatch}.");return()=>{let r=H.useRef(null);r.current||(r.current=M.prepare(e));let o=H.useContext(n);if(!o||typeof o!="object"||!("state"in o)||typeof o.dispatch!="function")throw new Error("Router: expected context value {state, dispatch}. Ensure your <StateProvider> supplies both.");let{state:a,dispatch:i}=o;H.useEffect(()=>{if(!i||!S)return;let p=S.listen(({location:s})=>{let h=s.pathname+(s.search||"");i({type:"LOCATION_CHANGED",location:h})});return i({type:"LOCATION_CHANGED",location:S.location.pathname+(S.location.search||"")}),()=>p()},[i]),H.useEffect(()=>{!ae&&i&&(F(i),ae=!0)},[i]);let u=(a.location||"/").split("?",1)[0],{Component:c,params:f}=M.match(r.current,u);return H.createElement(c,{...a,params:f,dispatch:i})}};import m from"react";var Ne=e=>m.createElement("div",{style:{padding:24}},m.createElement("h1",null,"Home"),m.createElement("p",null,"This is a tiny demo using the modernized router."),m.createElement("nav",{style:{display:"flex",gap:12}},m.createElement($,{to:"/"},"Home"),m.createElement($,{to:"/about"},"About"),m.createElement($,{to:"/users/42"},"User 42")),m.createElement("pre",{style:{background:"#f6f8fa",padding:12,marginTop:16}},JSON.stringify({state:e},null,2))),Ce=e=>m.createElement("div",{style:{padding:24}},m.createElement("h1",null,"About"),m.createElement("p",null,"Try navigating with modifier keys to open in a new tab."),m.createElement("nav",{style:{display:"flex",gap:12}},m.createElement($,{to:"/"},"Home"),m.createElement($,{to:"/about"},"About"),m.createElement($,{to:"/users/123"},"User 123")),m.createElement("pre",{style:{background:"#f6f8fa",padding:12,marginTop:16}},JSON.stringify({state:e},null,2))),He=({params:e,...n})=>m.createElement("div",{style:{padding:24}},m.createElement("h1",null,"User"),m.createElement("p",null,"User ID: ",m.createElement("strong",null,e.id)),m.createElement("nav",{style:{display:"flex",gap:12}},m.createElement($,{to:"/"},"Home"),m.createElement($,{to:"/about"},"About")),m.createElement("pre",{style:{background:"#f6f8fa",padding:12,marginTop:16}},JSON.stringify({params:e,state:n},null,2))),_e={"/":Ne,"/about":Ce,"/users/:id":He},ce=_e;var se={location:"/",title:"Demo",pageData:{}};function V(e,n){switch(n.type){case"LOCATION_CHANGED":return{...e,location:n.location};case"CHANGE_PAGE":{let t={...e,...n.data};return n.data&&n.data.location&&(t.location=n.data.location),t}default:return e}}G();var ue=De(null),je=({children:e})=>{let[n,t]=Re(V,se);return J.createElement(ue.Provider,{value:{state:n,dispatch:t}},e)},Ue=K(ce,ue),Ie=Me(document.getElementById("root"));Ie.render(J.createElement(je,null,J.createElement(Ue,null)));export{ue as StateContext};
