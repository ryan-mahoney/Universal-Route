var le=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(n,t)=>(typeof require<"u"?require:n)[t]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});import J,{createContext as De,useReducer as Me}from"react";import{createRoot as je}from"react-dom/client";function G({latency:e=120}={}){let n={"/":{title:"Home",pageData:{blurb:"Welcome to the demo."}},"/about":{title:"About",pageData:{blurb:"This is a mock backend."}}},t=/^\/users\/([^/]+)$/;globalThis.fetch=async r=>{let a=new URL(r,location.origin).pathname,o=200,g=n[a];if(!g){let s=a.match(t);if(s){let c=s[1];g={title:`User ${c}`,pageData:{id:c,role:"tester"}}}}return g||(o=404,g={title:"Not Found",pageData:{path:a}}),await new Promise(s=>setTimeout(s,e)),{status:o,json:async()=>g}}}import H from"react";function L(){return L=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},L.apply(this,arguments)}var N;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(N||(N={}));var B=function(e){return e};var z="beforeunload";var fe="popstate";function q(e){e===void 0&&(e={});var n=e,t=n.window,r=t===void 0?document.defaultView:t,i=r.history;function a(){var l=r.location,m=l.pathname,v=l.search,S=l.hash,$=i.state||{};return[$.idx,B({pathname:m,search:v,hash:S,state:$.usr||null,key:$.key||"default"})]}var o=null;function g(){if(o)d.call(o),o=null;else{var l=N.Pop,m=a(),v=m[0],S=m[1];if(d.length){if(v!=null){var $=f-v;$&&(o={action:l,location:S,retry:function(){k($*-1)}},k($))}}else D(l)}}r.addEventListener(fe,g);var s=N.Pop,c=a(),f=c[0],p=c[1],u=Y(),d=Y();f==null&&(f=0,i.replaceState(L({},i.state,{idx:f}),""));function h(l){return typeof l=="string"?l:de(l)}function x(l,m){return m===void 0&&(m=null),B(L({pathname:p.pathname,hash:"",search:""},typeof l=="string"?he(l):l,{state:m,key:pe()}))}function w(l,m){return[{usr:l.state,key:l.key,idx:m},h(l)]}function P(l,m,v){return!d.length||(d.call({action:l,location:m,retry:v}),!1)}function D(l){s=l;var m=a();f=m[0],p=m[1],u.call({action:s,location:p})}function E(l,m){var v=N.Push,S=x(l,m);function $(){E(l,m)}if(P(v,S,$)){var O=w(S,f+1),U=O[0],M=O[1];try{i.pushState(U,"",M)}catch{r.location.assign(M)}D(v)}}function _(l,m){var v=N.Replace,S=x(l,m);function $(){_(l,m)}if(P(v,S,$)){var O=w(S,f),U=O[0],M=O[1];i.replaceState(U,"",M),D(v)}}function k(l){i.go(l)}var R={get action(){return s},get location(){return p},createHref:h,push:E,replace:_,go:k,back:function(){k(-1)},forward:function(){k(1)},listen:function(m){return u.push(m)},block:function(m){var v=d.push(m);return d.length===1&&r.addEventListener(z,W),function(){v(),d.length||r.removeEventListener(z,W)}}};return R}function W(e){e.preventDefault(),e.returnValue=""}function Y(){var e=[];return{get length(){return e.length},push:function(t){return e.push(t),function(){e=e.filter(function(r){return r!==t})}},call:function(t){e.forEach(function(r){return r&&r(t)})}}}function pe(){return Math.random().toString(36).substr(2,8)}function de(e){var n=e.pathname,t=n===void 0?"/":n,r=e.search,i=r===void 0?"":r,a=e.hash,o=a===void 0?"":a;return i&&i!=="?"&&(t+=i.charAt(0)==="?"?i:"?"+i),o&&o!=="#"&&(t+=o.charAt(0)==="#"?o:"#"+o),t}function he(e){var n={};if(e){var t=e.indexOf("#");t>=0&&(n.hash=e.substr(t),e=e.substr(0,t));var r=e.indexOf("?");r>=0&&(n.search=e.substr(r),e=e.substr(0,r)),e&&(n.pathname=e)}return n}var X=typeof window<"u"&&window.document&&window.document.createElement?q():null;var b=X;var Q="scroll",me=()=>({y:window.pageYOffset||document.documentElement.scrollTop||0,x:window.pageXOffset||document.documentElement.scrollLeft||0}),ye=()=>{let{pathname:e,search:n}=window.location;return`${e}${n||""}`},Z=()=>{if(typeof sessionStorage>"u")return{};try{let e=sessionStorage.getItem(Q);return e?JSON.parse(e):{}}catch{return{}}},ge=e=>{if(!(typeof sessionStorage>"u"))try{sessionStorage.setItem(Q,JSON.stringify(e))}catch{}},ee=()=>{let e=Z();e[ye()]=me(),ge(e)};var te=(e="*")=>{let n=Z();return e==="*"?n:n[e]||null};import I from"react";function xe(e){let n=[],t=0;for(;t<e.length;){let r=e[t];if(r==="*"||r==="+"||r==="?"){n.push({type:"MODIFIER",index:t,value:e[t++]});continue}if(r==="\\"){n.push({type:"ESCAPED_CHAR",index:t++,value:e[t++]});continue}if(r==="{"){n.push({type:"OPEN",index:t,value:e[t++]});continue}if(r==="}"){n.push({type:"CLOSE",index:t,value:e[t++]});continue}if(r===":"){let i="",a=t+1;for(;a<e.length;){let o=e.charCodeAt(a);if(o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122||o===95){i+=e[a++];continue}break}if(!i)throw new TypeError(`Missing parameter name at ${t}`);n.push({type:"NAME",index:t,value:i}),t=a;continue}if(r==="("){let i=1,a="",o=t+1;if(e[o]==="?")throw new TypeError(`Pattern cannot start with "?" at ${o}`);for(;o<e.length;){if(e[o]==="\\"){a+=e[o++]+e[o++];continue}if(e[o]===")"){if(i--,i===0){o++;break}}else if(e[o]==="("&&(i++,e[o+1]!=="?"))throw new TypeError(`Capturing groups are not allowed at ${o}`);a+=e[o++]}if(i)throw new TypeError(`Unbalanced pattern at ${t}`);if(!a)throw new TypeError(`Missing pattern at ${t}`);n.push({type:"PATTERN",index:t,value:a}),t=o;continue}n.push({type:"CHAR",index:t,value:e[t++]})}return n.push({type:"END",index:t,value:""}),n}function ve(e,n={}){let t=xe(e),{prefixes:r="./",delimiter:i="/#?"}=n,a=[],o=0,g=0,s="",c=h=>{if(g<t.length&&t[g].type===h)return t[g++].value},f=h=>{let x=c(h);if(x!==void 0)return x;let{type:w,index:P}=t[g];throw new TypeError(`Unexpected ${w} at ${P}, expected ${h}`)},p=()=>{let h="",x;for(;x=c("CHAR")||c("ESCAPED_CHAR");)h+=x;return h},u=h=>{for(let x of i)if(h.indexOf(x)>-1)return!0;return!1},d=h=>{let x=a[a.length-1],w=h||(x&&typeof x=="string"?x:"");if(x&&!w)throw new TypeError(`Must have text between two parameters, missing text after "${x.name}"`);return!w||u(w)?`[^${A(i)}]+?`:`(?:(?!${A(w)})[^${A(i)}])+?`};for(;g<t.length;){let h=c("CHAR"),x=c("NAME"),w=c("PATTERN");if(x||w){let E=h||"";r.indexOf(E)===-1&&(s+=E,E=""),s&&(a.push(s),s=""),a.push({name:x||o++,prefix:E,suffix:"",pattern:w||d(E),modifier:c("MODIFIER")||""});continue}let P=h||c("ESCAPED_CHAR");if(P){s+=P;continue}if(s&&(a.push(s),s=""),c("OPEN")){let E=p(),_=c("NAME")||"",k=c("PATTERN")||"",R=p();f("CLOSE"),a.push({name:_||(k?o++:""),pattern:_&&!k?d(E):k,prefix:E,suffix:R,modifier:c("MODIFIER")||""});continue}f("END")}return a}function ne(e,n){let t=[],r=oe(e,t,n);return we(r,t,n)}function we(e,n,t={}){let{decode:r=i=>i}=t;return function(i){let a=e.exec(i);if(!a)return!1;let{0:o,index:g}=a,s=Object.create(null);for(let c=1;c<a.length;c++){if(a[c]===void 0)continue;let f=n[c-1];f.modifier==="*"||f.modifier==="+"?s[f.name]=a[c].split(f.prefix+f.suffix).map(p=>r(p,f)):s[f.name]=r(a[c],f)}return{path:o,index:g,params:s}}}function A(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function re(e){return e&&e.sensitive?"":"i"}function be(e,n){if(!n)return e;let t=/\((?:\?<(.*?)>)?(?!\?)/g,r=0,i=t.exec(e.source);for(;i;)n.push({name:i[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),i=t.exec(e.source);return e}function Ee(e,n,t){let r=e.map(i=>oe(i,n,t).source);return new RegExp(`(?:${r.join("|")})`,re(t))}function $e(e,n,t){return Te(ve(e,t),n,t)}function Te(e,n,t={}){let{strict:r=!1,start:i=!0,end:a=!0,encode:o=u=>u,delimiter:g="/#?",endsWith:s=""}=t,c=`[${A(s)}]|$`,f=`[${A(g)}]`,p=i?"^":"";for(let u of e)if(typeof u=="string")p+=A(o(u));else{let d=A(o(u.prefix)),h=A(o(u.suffix));if(u.pattern)if(n&&n.push(u),d||h)if(u.modifier==="+"||u.modifier==="*"){let x=u.modifier==="*"?"?":"";p+=`(?:${d}((?:${u.pattern})(?:${h}${d}(?:${u.pattern}))*)${h})${x}`}else p+=`(?:${d}(${u.pattern})${h})${u.modifier}`;else{if(u.modifier==="+"||u.modifier==="*")throw new TypeError(`Can not repeat "${u.name}" without a prefix and suffix`);p+=`(${u.pattern})${u.modifier}`}else p+=`(?:${d}${h})${u.modifier}`}if(a)r||(p+=`${f}?`),p+=t.endsWith?`(?=${c})`:"$";else{let u=e[e.length-1],d=typeof u=="string"?f.indexOf(u[u.length-1])>-1:u===void 0;r||(p+=`(?:${f}(?=${c}))?`),d||(p+=`(?=${f}|${c})`)}return new RegExp(p,re(t))}function oe(e,n,t){return e instanceof RegExp?be(e,n):Array.isArray(e)?Ee(e,n,t):$e(e,n,t)}var ke=()=>I.createElement("div",{style:{padding:24}},I.createElement("h1",null,"404"),I.createElement("p",null,"Page not found")),Se=(e,n)=>{for(let t of e){let r=t.matcher(n);if(r)return{route:t,params:r.params||{}}}return null},j={match:(e,n)=>{let t=Se(e,n);if(!t)return{Component:ke,reducerKey:null,params:{}};let{route:r,params:i}=t,{Component:a,reducerKey:o}=r;return{Component:a,reducerKey:o,params:i}},prepare:e=>Object.keys(e).map(n=>{let t=e[n],r,i;return Array.isArray(t)?[r,i]=t:r=t,{path:n,matcher:ne(n,{decode:decodeURIComponent}),Component:r,reducerKey:i||null}})};var Ae=()=>{if(typeof globalThis<"u"&&globalThis.crypto){if(typeof globalThis.crypto.randomUUID=="function")return globalThis.crypto.randomUUID();let e=new Uint8Array(16);globalThis.crypto.getRandomValues(e),e[6]=e[6]&15|64,e[8]=e[8]&63|128;let n=[...e].map(t=>t.toString(16).padStart(2,"0"));return`${n.slice(0,4).join("")}-${n.slice(4,6).join("")}-${n.slice(6,8).join("")}-${n.slice(8,10).join("")}-${n.slice(10).join("")}`}try{let{randomUUID:e}=le("node:crypto");if(typeof e=="function")return e()}catch{}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let n=Math.random()*16|0;return(e==="x"?n:n&3|8).toString(16)})},ie=Symbol.for("handleHistoryChange:installed"),C=null;function Pe(){try{if(typeof window<"u"&&window.location&&window.location.origin)return window.location.origin}catch{}return"http://localhost"}function Oe(e){let n=new URL((e.pathname||"/")+(e.search||""),Pe());return n.searchParams.set("uuid",Ae()),n.toString()}function Le(e){return e===404?"404":Math.floor(e/100)===5?"5xx":"ok"}function F(e,{history:n,fetchImpl:t=typeof fetch<"u"&&fetch||null,setTitle:r=function(a){typeof document<"u"&&a&&(document.title=a)},progress:i={start(){},done(){}}}={}){!n||!t||n[ie]||(n[ie]=!0,n.listen(function({location:a,action:o}){if(C&&typeof C.abort=="function")try{C.abort()}catch{}C=typeof AbortController<"u"?new AbortController:null,i&&typeof i.done=="function"&&i.done(),i&&typeof i.start=="function"&&i.start();let g=Oe(a);Promise.resolve(t(g,{method:"GET",headers:{Accept:"application/json"},signal:C?C.signal:void 0})).then(function(s){let c=s&&s.json?s.json():{};return Promise.resolve(c).then(function(f){return{status:s?s.status:503,data:f||{}}}).catch(function(){return{status:s?s.status:503,data:{}}})}).catch(function(s){return{status:503,data:{}}}).then(function({status:s,data:c}){i&&typeof i.done=="function"&&i.done();let f=c&&c.authorization&&c.authorization.location,p=f||a.pathname||"/";if(!f){let u=Le(s);u==="404"?p="/404":u==="5xx"&&(p="/500")}if(e({type:"CHANGE_PAGE",data:Object.assign({},c,{location:p})}),c&&c.title&&r(c.title),typeof window<"u"&&window.scrollTo)if(o==="PUSH")window.scrollTo(0,0);else{let u=(a.pathname||"/")+(a.search||""),d=te(u);d&&setTimeout(function(){window.scrollTo(d.x||0,d.y||0)},250)}})}))}var ae=!1,T=({to:e,className:n,children:t,mode:r="push",onMouseEnter:i,onMouseLeave:a,style:o={},...g})=>H.createElement("a",{href:e,className:n,onClick:c=>{c.defaultPrevented||c.button!==0||c.metaKey||c.ctrlKey||c.altKey||c.shiftKey||(c.preventDefault(),ee(),b&&(r==="replace"?b.replace(e):b.push(e)))},onMouseEnter:i,onMouseLeave:a,style:o,...g},t);var K=(e,n)=>t=>{let r=H.useRef(null);r.current||(r.current=j.prepare(e));let i=n?H.useContext(n):{state:t||{},dispatch:!1},{state:a={},dispatch:o=!1}=i||{};H.useEffect(()=>{if(!(o&&typeof o=="function")||!b)return;let p=({location:d})=>{let h=d.pathname+(d.search||"");o({type:"LOCATION_CHANGED",location:h})},u=b.listen(p);return o({type:"LOCATION_CHANGED",location:b.location.pathname+(b.location.search||"")}),()=>u()},[o]),H.useEffect(()=>{!ae&&o&&typeof o=="function"&&(F(o),ae=!0)},[o]);let g=a.location||b&&b.location&&b.location.pathname+(b.location.search||"")||t&&t.location||"/",s=String(g).split("?",1)[0],{Component:c,params:f}=j.match(r.current,s);return H.createElement(c,{...a,params:f,dispatch:o})};import y from"react";var Ne=e=>y.createElement("div",{style:{padding:24}},y.createElement("h1",null,"Home"),y.createElement("p",null,"This is a tiny demo using the modernized router."),y.createElement("nav",{style:{display:"flex",gap:12}},y.createElement(T,{to:"/"},"Home"),y.createElement(T,{to:"/about"},"About"),y.createElement(T,{to:"/users/42"},"User 42")),y.createElement("pre",{style:{background:"#f6f8fa",padding:12,marginTop:16}},JSON.stringify({state:e},null,2))),Ce=e=>y.createElement("div",{style:{padding:24}},y.createElement("h1",null,"About"),y.createElement("p",null,"Try navigating with modifier keys to open in a new tab."),y.createElement("nav",{style:{display:"flex",gap:12}},y.createElement(T,{to:"/"},"Home"),y.createElement(T,{to:"/about"},"About"),y.createElement(T,{to:"/users/123"},"User 123")),y.createElement("pre",{style:{background:"#f6f8fa",padding:12,marginTop:16}},JSON.stringify({state:e},null,2))),He=({params:e,...n})=>y.createElement("div",{style:{padding:24}},y.createElement("h1",null,"User"),y.createElement("p",null,"User ID: ",y.createElement("strong",null,e.id)),y.createElement("nav",{style:{display:"flex",gap:12}},y.createElement(T,{to:"/"},"Home"),y.createElement(T,{to:"/about"},"About")),y.createElement("pre",{style:{background:"#f6f8fa",padding:12,marginTop:16}},JSON.stringify({params:e,state:n},null,2))),_e={"/":Ne,"/about":Ce,"/users/:id":He},ce=_e;var se={location:"/",title:"Demo",pageData:{}};function V(e,n){switch(n.type){case"LOCATION_CHANGED":return{...e,location:n.location};case"CHANGE_PAGE":{let t={...e,...n.data};return n.data&&n.data.location&&(t.location=n.data.location),t}default:return e}}G();var ue=De(null),Re=({children:e})=>{let[n,t]=Me(V,se);return J.createElement(ue.Provider,{value:{state:n,dispatch:t}},e)},Ue=K(ce,ue),Ie=je(document.getElementById("root"));Ie.render(J.createElement(Re,null,J.createElement(Ue,null)));export{ue as StateContext};
