import M,{createContext as xt,useReducer as bt}from"react";import{createRoot as wt}from"react-dom/client";function V({latency:t=120}={}){let e={"/":{title:"Home",pageData:{blurb:"Welcome to the demo."}},"/about":{title:"About",pageData:{blurb:"This is a mock backend."}}},n=/^\/users\/([^/]+)$/;globalThis.fetch=async r=>{let u=new URL(r,location.origin).pathname,i=200,l=e[u];if(!l){let d=u.match(n);if(d){let f=d[1];l={title:`User ${f}`,pageData:{id:f,role:"tester"}}}}return l||(i=404,l={title:"Not Found",pageData:{path:u}}),await new Promise(d=>setTimeout(d,t)),{status:i,json:async()=>l}}}import Y,{useContext as pt,useEffect as ft,useMemo as W,useRef as ht,useState as dt}from"react";function E(){return E=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},E.apply(this,arguments)}var L;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(L||(L={}));var U=function(t){return t};var B="beforeunload";var R="popstate";function G(t){t===void 0&&(t={});var e=t,n=e.window,r=n===void 0?document.defaultView:n,o=r.history;function u(){var a=r.location,s=a.pathname,p=a.search,g=a.hash,m=o.state||{};return[m.idx,U({pathname:s,search:p,hash:g,state:m.usr||null,key:m.key||"default"})]}var i=null;function l(){if(i)y.call(i),i=null;else{var a=L.Pop,s=u(),p=s[0],g=s[1];if(y.length){if(p!=null){var m=h-p;m&&(i={action:a,location:g,retry:function(){H(m*-1)}},H(m))}}else b(a)}}r.addEventListener(R,l);var d=L.Pop,f=u(),h=f[0],x=f[1],P=J(),y=J();h==null&&(h=0,o.replaceState(E({},o.state,{idx:h}),""));function O(a){return typeof a=="string"?a:et(a)}function A(a,s){return s===void 0&&(s=null),U(E({pathname:x.pathname,hash:"",search:""},typeof a=="string"?nt(a):a,{state:s,key:tt()}))}function N(a,s){return[{usr:a.state,key:a.key,idx:s},O(a)]}function C(a,s,p){return!y.length||(y.call({action:a,location:s,retry:p}),!1)}function b(a){d=a;var s=u();h=s[0],x=s[1],P.call({action:d,location:x})}function K(a,s){var p=L.Push,g=A(a,s);function m(){K(a,s)}if(C(p,g,m)){var k=N(g,h+1),T=k[0],S=k[1];try{o.pushState(T,"",S)}catch{r.location.assign(S)}b(p)}}function j(a,s){var p=L.Replace,g=A(a,s);function m(){j(a,s)}if(C(p,g,m)){var k=N(g,h),T=k[0],S=k[1];o.replaceState(T,"",S),b(p)}}function H(a){o.go(a)}var Z={get action(){return d},get location(){return x},createHref:O,push:K,replace:j,go:H,back:function(){H(-1)},forward:function(){H(1)},listen:function(s){return P.push(s)},block:function(s){var p=y.push(s);return y.length===1&&r.addEventListener(B,I),function(){p(),y.length||r.removeEventListener(B,I)}}};return Z}function I(t){t.preventDefault(),t.returnValue=""}function J(){var t=[];return{get length(){return t.length},push:function(n){return t.push(n),function(){t=t.filter(function(r){return r!==n})}},call:function(n){t.forEach(function(r){return r&&r(n)})}}}function tt(){return Math.random().toString(36).substr(2,8)}function et(t){var e=t.pathname,n=e===void 0?"/":e,r=t.search,o=r===void 0?"":r,u=t.hash,i=u===void 0?"":u;return o&&o!=="?"&&(n+=o.charAt(0)==="?"?o:"?"+o),i&&i!=="#"&&(n+=i.charAt(0)==="#"?i:"#"+i),n}function nt(t){var e={};if(t){var n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));var r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}var z=typeof window<"u"&&window.document&&window.document.createElement?G():null;var w=z;var rt=t=>t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),ot=t=>{if(!t||t==="/")return{regex:/^\/?$/,names:[]};if(t==="*"||t==="/*")return{regex:/^.*$/,names:[]};let e=String(t).split("/").filter(Boolean).map(o=>{if(o.startsWith(":")){let u=o.slice(1);return{src:`(?<${u}>[^/]+)`,name:u}}return{src:rt(o),name:null}}),n="^/"+e.map(o=>o.src).join("/")+"/?$",r=e.filter(o=>o.name).map(o=>o.name);return{regex:new RegExp(n),names:r}},at=()=>"404",it=(t,e)=>{let n,r;return Array.isArray(e)?[n,r]=e:typeof e=="function"?n=e:e&&typeof e=="object"?(n=e.Component||e.element||e.render||(()=>null),r=e.reducerKey):n=()=>null,{path:t,Component:n,reducerKey:r}},st=(t={})=>{let{path:e="/",reducerKey:n}=t,r=t.Component||t.element||t.render||(()=>null);return{path:e,Component:r,reducerKey:n}},ct=t=>{if(Array.isArray(t))return t.map(st);if(t&&typeof t=="object")return Object.entries(t).map(([e,n])=>it(e,n));throw new TypeError("routes must be an array of route objects or a map of { path: Component | [Component, reducerKey] }")},F=(t=[])=>ct(t).map(n=>{if(n.path==="*"||n.path==="/*")return{...n,matcher:()=>({params:{}})};let{regex:r,names:o}=ot(n.path);return{...n,matcher:i=>{let l=r.exec(i);return l?{params:l.groups?Object.fromEntries(Object.entries(l.groups).map(([f,h])=>[f,decodeURIComponent(h)])):o.reduce((f,h,x)=>(f[h]=decodeURIComponent(l[x+1]),f),{})}:null}}}),ut=(t,e)=>{for(let r of t){if(typeof r.matcher!="function")continue;let o=r.matcher(e);if(o)return{Component:r.Component,params:o.params||{},reducerKey:r.reducerKey}}let n=t.find(r=>r.path==="*"||r.path==="/*");return n?{Component:n.Component,params:{},reducerKey:n.reducerKey}:{Component:at,params:{}}},lt=(t,e)=>{let r=Array.isArray(t)&&t.every(o=>typeof o=="object"&&typeof o.matcher=="function")?t:F(t);return ut(r,e)},_={prepare:F,match:lt};var v=({to:t,replace:e=!1,state:n,onClick:r,...o})=>{let u=i=>{r&&r(i),!(i.defaultPrevented||i.button!==0||i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)&&(i.preventDefault(),e?w.replace(t,n):w.push(t,n))};return Y.createElement("a",{href:typeof t=="string"?t:t?.pathname||"#",onClick:u,...o})},D=(t,e)=>n=>{let r=e?pt(e):{state:n,dispatch:!1},{state:o,dispatch:u}=r||{},i=W(()=>_.prepare(t),[t]),l=(w?.location?.pathname||"")+(w?.location?.search||""),d=o&&o.location||l,f=ht(d),[h,x]=dt(d);ft(()=>{if(!w||typeof w.listen!="function")return;let A=w.listen(({location:N,action:C})=>{let b=(N.pathname||"")+(N.search||"");b!==f.current&&(f.current=b,x(b),typeof u=="function"&&u({type:"LOCATION_CHANGED",location:b,meta:{action:C}}))});return()=>{typeof A=="function"&&A()}},[u]);let P=(h||"").split("?")[0],y=W(()=>_.match(i,P),[i,P]),O=y?.Component||(()=>null);return Y.createElement(O,{...o,...y.params,dispatch:u})};import c from"react";var mt=t=>c.createElement("div",{style:{padding:24}},c.createElement("h1",null,"Home"),c.createElement("p",null,"This is a tiny demo using the modernized router."),c.createElement("nav",{style:{display:"flex",gap:12}},c.createElement(v,{to:"/"},"Home"),c.createElement(v,{to:"/about"},"About"),c.createElement(v,{to:"/users/42"},"User 42")),c.createElement("pre",{style:{background:"#f6f8fa",padding:12,marginTop:16}},JSON.stringify({state:t},null,2))),yt=t=>c.createElement("div",{style:{padding:24}},c.createElement("h1",null,"About"),c.createElement("p",null,"Try navigating with modifier keys to open in a new tab."),c.createElement("nav",{style:{display:"flex",gap:12}},c.createElement(v,{to:"/"},"Home"),c.createElement(v,{to:"/about"},"About"),c.createElement(v,{to:"/users/123"},"User 123")),c.createElement("pre",{style:{background:"#f6f8fa",padding:12,marginTop:16}},JSON.stringify({state:t},null,2))),vt=({id:t})=>c.createElement("div",{style:{padding:24}},c.createElement("h1",null,"User"),c.createElement("p",null,"User ID: ",c.createElement("strong",null,t)),c.createElement("nav",{style:{display:"flex",gap:12}},c.createElement(v,{to:"/"},"Home"),c.createElement(v,{to:"/about"},"About"))),gt={"/":mt,"/about":yt,"/users/:id":vt},q=gt;var Q={location:"/",title:"Demo",pageData:{}};function $(t,e){switch(e.type){case"LOCATION_CHANGED":return{...t,location:e.location};case"CHANGE_PAGE":{let n={...t,...e.data};return e.data&&e.data.location&&(n.location=e.data.location),n}default:return t}}V();var X=xt(null),kt=({children:t})=>{let[e,n]=bt($,Q);return M.createElement(X.Provider,{value:{state:e,dispatch:n}},t)},Et=D(q,X),Lt=wt(document.getElementById("root"));Lt.render(M.createElement(kt,null,M.createElement(Et,null)));export{X as StateContext};
