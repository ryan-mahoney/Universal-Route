import _,{createContext as fe,useReducer as le}from"react";import{createRoot as pe}from"react-dom/client";function j({latency:e=120}={}){let t={"/":{title:"Home",pageData:{blurb:"Welcome to the demo."}},"/about":{title:"About",pageData:{blurb:"This is a mock backend."}}},n=/^\/users\/([^/]+)$/;globalThis.fetch=async o=>{let u=new URL(o,location.origin).pathname,a=200,h=t[u];if(!h){let l=u.match(n);if(l){let x=l[1];h={title:`User ${x}`,pageData:{id:x,role:"tester"}}}}return h||(a=404,h={title:"Not Found",pageData:{path:u}}),await new Promise(l=>setTimeout(l,e)),{status:a,json:async()=>h}}}import B,{useContext as ee,useEffect as te,useMemo as ne,useRef as re,useState as oe}from"react";function $(){return $=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},$.apply(this,arguments)}var k;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(k||(k={}));var I=function(e){return e};var U="beforeunload";var q="popstate";function K(e){e===void 0&&(e={});var t=e,n=t.window,o=n===void 0?document.defaultView:n,s=o.history;function u(){var r=o.location,i=r.pathname,f=r.search,v=r.hash,p=s.state||{};return[p.idx,I({pathname:i,search:f,hash:v,state:p.usr||null,key:p.key||"default"})]}var a=null;function h(){if(a)y.call(a),a=null;else{var r=k.Pop,i=u(),f=i[0],v=i[1];if(y.length){if(f!=null){var p=m-f;p&&(a={action:r,location:v,retry:function(){A(p*-1)}},A(p))}}else H(r)}}o.addEventListener(q,h);var l=k.Pop,x=u(),m=x[0],w=x[1],L=F(),y=F();m==null&&(m=0,s.replaceState($({},s.state,{idx:m}),""));function T(r){return typeof r=="string"?r:X(r)}function P(r,i){return i===void 0&&(i=null),I($({pathname:w.pathname,hash:"",search:""},typeof r=="string"?Z(r):r,{state:i,key:Q()}))}function O(r,i){return[{usr:r.state,key:r.key,idx:i},T(r)]}function E(r,i,f){return!y.length||(y.call({action:r,location:i,retry:f}),!1)}function H(r){l=r;var i=u();m=i[0],w=i[1],L.call({action:l,location:w})}function M(r,i){var f=k.Push,v=P(r,i);function p(){M(r,i)}if(E(f,v,p)){var b=O(v,m+1),S=b[0],N=b[1];try{s.pushState(S,"",N)}catch{o.location.assign(N)}H(f)}}function R(r,i){var f=k.Replace,v=P(r,i);function p(){R(r,i)}if(E(f,v,p)){var b=O(v,m),S=b[0],N=b[1];s.replaceState(S,"",N),H(f)}}function A(r){s.go(r)}var Y={get action(){return l},get location(){return w},createHref:T,push:M,replace:R,go:A,back:function(){A(-1)},forward:function(){A(1)},listen:function(i){return L.push(i)},block:function(i){var f=y.push(i);return y.length===1&&o.addEventListener(U,V),function(){f(),y.length||o.removeEventListener(U,V)}}};return Y}function V(e){e.preventDefault(),e.returnValue=""}function F(){var e=[];return{get length(){return e.length},push:function(n){return e.push(n),function(){e=e.filter(function(o){return o!==n})}},call:function(n){e.forEach(function(o){return o&&o(n)})}}}function Q(){return Math.random().toString(36).substr(2,8)}function X(e){var t=e.pathname,n=t===void 0?"/":t,o=e.search,s=o===void 0?"":o,u=e.hash,a=u===void 0?"":u;return s&&s!=="?"&&(n+=s.charAt(0)==="?"?s:"?"+s),a&&a!=="#"&&(n+=a.charAt(0)==="#"?a:"#"+a),n}function Z(e){var t={};if(e){var n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));var o=e.indexOf("?");o>=0&&(t.search=e.substr(o),e=e.substr(0,o)),e&&(t.pathname=e)}return t}var J=typeof window<"u"&&window.document&&window.document.createElement?K():null;var g=J;var d=({to:e,replace:t=!1,state:n,onClick:o,...s})=>{let u=a=>{o&&o(a),!(a.defaultPrevented||a.button!==0||a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)&&(a.preventDefault(),t?g.replace(e,n):g.push(e,n))};return B.createElement("a",{href:typeof e=="string"?e:e?.pathname||"#",onClick:u,...s})},ie=(e,t)=>{let n=e.find(o=>o.path===t);return n||e.find(o=>o.path==="*")||null},C=(e,t)=>n=>{let o=t?ee(t):{state:n,dispatch:!1},{state:s,dispatch:u}=o||{},a=(g?.location?.pathname||"")+(g?.location?.search||""),h=s&&s.location||a,l=re(h),[x,m]=oe(h);te(()=>{if(!g||typeof g.listen!="function")return;let T=g.listen(({location:P,action:O})=>{let E=(P.pathname||"")+(P.search||"");E!==l.current&&(l.current=E,m(E),typeof u=="function"&&u({type:"LOCATION_CHANGED",location:E,meta:{action:O}}))});return()=>{typeof T=="function"&&T()}},[u]);let w=(x||"").split("?")[0],y=ne(()=>ie(e,w),[e,w])?.element||(()=>null);return B.createElement(y,null)};import Le from"react";import c from"react";var ae=e=>c.createElement("div",{style:{padding:24}},c.createElement("h1",null,"Home"),c.createElement("p",null,"This is a tiny demo using the modernized router."),c.createElement("nav",{style:{display:"flex",gap:12}},c.createElement(d,{to:"/"},"Home"),c.createElement(d,{to:"/about"},"About"),c.createElement(d,{to:"/users/42"},"User 42")),c.createElement("pre",{style:{background:"#f6f8fa",padding:12,marginTop:16}},JSON.stringify({state:e},null,2))),ce=e=>c.createElement("div",{style:{padding:24}},c.createElement("h1",null,"About"),c.createElement("p",null,"Try navigating with modifier keys to open in a new tab."),c.createElement("nav",{style:{display:"flex",gap:12}},c.createElement(d,{to:"/"},"Home"),c.createElement(d,{to:"/about"},"About"),c.createElement(d,{to:"/users/123"},"User 123")),c.createElement("pre",{style:{background:"#f6f8fa",padding:12,marginTop:16}},JSON.stringify({state:e},null,2))),se=({params:e,...t})=>c.createElement("div",{style:{padding:24}},c.createElement("h1",null,"User"),c.createElement("p",null,"User ID: ",c.createElement("strong",null,e.id)),c.createElement("nav",{style:{display:"flex",gap:12}},c.createElement(d,{to:"/"},"Home"),c.createElement(d,{to:"/about"},"About")),c.createElement("pre",{style:{background:"#f6f8fa",padding:12,marginTop:16}},JSON.stringify({params:e,state:t},null,2))),ue={"/":ae,"/about":ce,"/users/:id":se},G=ue;var W={location:"/",title:"Demo",pageData:{}};function D(e,t){switch(t.type){case"LOCATION_CHANGED":return{...e,location:t.location};case"CHANGE_PAGE":{let n={...e,...t.data};return t.data&&t.data.location&&(n.location=t.data.location),n}default:return e}}j();var z=fe(null),he=({children:e})=>{let[t,n]=le(D,W);return _.createElement(z.Provider,{value:{state:t,dispatch:n}},e)},de=C(G,z),me=pe(document.getElementById("root"));me.render(_.createElement(he,null,_.createElement(de,null)));export{z as StateContext};
